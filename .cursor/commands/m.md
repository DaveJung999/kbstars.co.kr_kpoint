---
name: m
description: 2단계 실제 소스 수정 (PHP 업그레이드 Batch 단일 처리, 토큰 절감 최우선)
---

# 목적
본 명령어는 **PHP 업그레이드** 작업의 실제 소스 수정 단계 전용으로,  
AI 활용 시 **토큰 과다 사용 절감 및 핵심 규칙 준수**에 초점을 둔다.  
- 반드시 `.ai/cursor_agent.rules.md` 기준만 따른다.
- 오직 `/p`(전략수립) 단계에서 승인된 Batch 파일 목록 기준, **Batch 단일 처리**  
- 각 Batch 종료 직후 "잔여 Batch 수", "다음 진행 여부"만 표로 안내  
- 전체 결과 및 코드 상세 노출 금지(표 요약만), Batch 외 파일/코드 접근 금지

## Batch 처리 핵심 흐름
- **Batch 1개 완료 시:**  
	- 잔여 Batch, 진행여부만 최소 요약 표로 안내  
	- 사용자 의사(네/아니오) 확인 후 다음 Batch 순차 진행  
- **모든 Batch 완료 시:**  
	- 전체 Batch별 작업 요약 표로 안내  
	- "/v(검증) 단계로 진행할까요?"만 질의(예시 답변: 네/yes)
- 코드/차이/전체 파일 등 상세 내용 노출 및 불필요 토큰 사용 일절 금지

# PHP 업그레이드 소스 수정 절대 원칙

**1. 코드 보존 및 이력관리**
- 기존 코드는 최대한 보존, 필요 최소한의 수정(오류 또는 비호환 부분만)
- 코드 수정 시 반드시 [수정이력] 섹션에 오늘 날짜와 한 줄 요약(최신순, 중복X) 남김
- Tab 기반 들여쓰기

**2. PHP 업그레이드 체크리스트**
- 짧은 태그(<?=, <? 등) → <?php 변환
- deprecated 함수/문법 최신 버전으로 대체
- 경고/코어 함수 변경(PHP8~), 타입 선언 추가 필요시만 최소화 반영  
- `try-catch` 등 예외처리, 부적합 활용(레거시 코드 등) 검토 후 교체  
- 환경별 차이(DB, 세션 등) 발생여부 판단 후, 영향 줄이도록 수정  
- 기존 기능/로직 영향 최소화가 원칙

---

# Batch Output Format (토큰 최소화, 표 중심)

- **현재 Batch만 표로 안내(경로/파일명 표기, 코드 X)**
- Batch 진행/대기 표(잔여 Batch 개수, 상태)로 요약  
- 종료 시마다 "**잔여 Batch/진행여부**"만 질의

### [수정 대상 파일: (경로/파일명만 표로, 코드/라인 금지)]
1. **수정 요약:** (주요 업그레이드 변경점만 1줄 요약)

### [Batch 진행 현황]
| Batch 번호 | 상태 | 주요 변경 요약 |
|:---:|:---:|:---|
| 1 | 완료 | ... |
| 2 | 대기중 | ... |
| ... | ... | ... |

- **잔여 Batch**: N개 / **다음 Batch 진행할까요? (네/아니오)**

### [전체 Batch 완료 시]
- 전체 작업 내역만 표로 압축
- 질의: "/v(검증) 단계로 진행할까요?"

---
