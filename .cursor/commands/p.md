---
name: p
description: 1단계 전략 수립 (PHP 업그레이드 전체 영향 범위 산정, Batch 분할 수행, 정보 최소 노출 및 일괄 배포 정책)
---

# Context
본 명령어는 `.ai/cursor_agent.rules.md`의 1단계 기준에 따라 **PHP 업그레이드 전략** 설계를 위한 명령입니다.  
전체 영향 PHP 파일을 표로 정리하고, Batch(10~20개 단위)로 분할하여 토큰 소모 및 정보 노출을 최소화합니다.  
**각 Batch별로 후속 수정 명령(/m) 자동 분기**만 안내합니다.  
- 도메인별(`a/`, `common/` 등) PHP 파일 우선 그룹핑
- 각 Batch별 명령어를 분리(→ /m)로 안내
- 각 Batch 및 전체 diff/코드 챗 노출 금지

**모든 Batch가 종료된 후** /v(검증) 단계에 진입하여, 일괄 commit & push를 진행합니다.  
**Batch 처리 도중에는 commit & push 및 배포 없이, 검증 이후 1회만 처리**합니다.

---

# 실행 절차

1. **전체 수정 범위 산정 (Full Scope)**
	- 영향받는 모든 PHP 파일을 표로 요약
	- 도메인/경로별로 Batch 그룹화(최대 10~20개 단위)

2. **Batch별 실행 분할**
	- Batch 1(최우선)만 상세 전략, 나머지는 Summary
	- 각 Batch별 수행 명령어(/m) 분기

3. **PHP 업그레이드 핵심 체크 및 방어**
	- 단축 태그, deprecated 함수 등 주요 이슈별 체크
	- 파일별 이전 버전 함수/문법 교체 범위 요약
	- 영향 최소화 위해 사전/후처리 및 코드 감싸기 필요시 요약

4. **검증 및 최종 일괄 배포**
	- Batch 1 → N 순차로 진행
	- **모든 Batch 완료 후 /v(검증) 단계 진입, 검토 완료 시에만 commit & push 및 서비스 배포**  
	- 중간 단계에서는 커밋, 배포, diff 노출 등 절대 금지

---

# Output Format

### 1. 전체 수정 대상 리스트 (Full Scope)
| 순서 | 파일 경로 | 도메인 | 주요 이슈 | 우선순위 | Batch |
|:---|:---|:---|:---|:---|:---|
| 1 | `a/index.php` | 주식 | 단축 태그 | 매우 높음 | Batch 1 (/m) |
| 2 | `common/util.php` | 공통 | deprecated 함수 | 매우 높음 | Batch 1 (/m) |
| 3 | `a/conf.php` | 주식 | 버전 비호환 | 높음 | Batch 2 (/m) |
| 4 | `common/route.php` | 공통 | 함수 변경 | 높음 | Batch 2 (/m) |
| 5 | ... | ... | ... | ... | ... |

### 2. [Batch 1] 상세 전략
- **주요 PHP 업그레이드 이슈 우선 처리:**  
	- `a/index.php`: 단축 태그 → 표준 태그로 교체  
	- `common/util.php`: deprecated 함수 → 지원 함수로 교체  
- 공통모듈, 핵심 출입점 파일 등을 최우선 처리
- 영향 최소화 위해 function 단위 변경 및 적절한 주석 추가 권장

### 3. 기술/작업 순서 요약
| Batch | 주요 내용 | 키워드 |
|:---:|:---|:---|
| 1 | 핵심/공통: 태그&함수 교체, 비호환 해결 | 단축 태그, deprecated |
| 2 | 추가 파일/기타 영향: 함수/문법 정리 | 일괄 함수 업데이트 |
| 3 | 마무리/정리: 불필요 코드 제거 등 | 리펙토링/테스트 |

---

### 4. 다음 단계 및 일괄 커밋/배포 정책

- "**위 전략에 따라 Batch별로 순차 소스수정(/m)을 진행하며, 모든 Batch가 완료되면 /v(검증)으로 자동 진입합니다.**"
- **/v(검증) 완료 이후 단 1회 commit & push 및 서비스 재배포 진행**  
- 과정 중간에는 commit/push/배포 없이 Batch진행 현황만 안내

---

**주의:**  
- 중간 커밋/배포, 코드/diff/전체 내용 노출 절대 금지  
- Batch 1 내역만 상세, 나머지 요약  
- 각 Batch의 PHP 업그레이드 이슈만 명시, 그 외 불필요 내용 배제

---